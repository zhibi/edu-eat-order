define("waimai:widget/usercenter/left/left/left",function(require,exports,module){function _countDown(t){countDown>0?(t.val("重新获取（"+countDown+"s）"),--countDown,setTimeout(function(){_countDown(t)},1e3)):t.val("发送动态码")}var PaginationStandard=require("waimai:widget/common/ui/pagination/standard/standard"),Dialog=require("jsmod/ui/dialog"),lefttmpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push('<tr class="list-holderplace">&nbsp;</tr>'),0!=transList.length){_template_fun_array.push("");for(var i in transList){_template_fun_array.push("");var list=transList[i];_template_fun_array.push("");var trans_type="1"==list.trans_type?"+":"-";_template_fun_array.push("<tr><td>","undefined"==typeof list.create_time?"":baidu.template._encodeHTML(list.create_time),"</td><td>","undefined"==typeof list.trans_msg?"":baidu.template._encodeHTML(list.trans_msg),"</td><td>","undefined"==typeof list.order_id?"":baidu.template._encodeHTML(list.order_id),'</td><td class="',"undefined"==typeof("1"==list.trans_type?"positive":"negative")?"":baidu.template._encodeHTML("1"==list.trans_type?"positive":"negative"),'">',"undefined"==typeof trans_type?"":baidu.template._encodeHTML(trans_type),"","undefined"==typeof list.trans_amount?"":baidu.template._encodeHTML(list.trans_amount),"</td><td>","undefined"==typeof list.left_amount?"":baidu.template._encodeHTML(list.left_amount),"</td></tr>")}_template_fun_array.push("")}else _template_fun_array.push("<tr>    <td>","undefined"==typeof timeTxt?"":baidu.template._encodeHTML(timeTxt),"无数据</td>    <td>&nbsp;</td>    <td>&nbsp;</td>    <td>&nbsp;</td>    <td>&nbsp;</td></tr>");_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],limittmpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="dialog-limit" data-node="dialog-limit"><p class="title">额度设置</p><div class="info"><span>已绑定手机</span><span class="phone_num">',"undefined"==typeof phonenum?"":baidu.template._encodeHTML(phonenum),'</span><input value="',"undefined"==typeof(0==countDown?"发送动态码":"（"+countDown+"）重新获取")?"":baidu.template._encodeHTML(0==countDown?"发送动态码":"（"+countDown+"）重新获取"),'" type="button" class="send_code" data-node="send_code" /></div><div class="label-input"><label>验证码</label><input data-node="code" placeholder="请输入验证码" /></div><div class="label-input"><label>支付额度</label><input data-node="account" placeholder="请输入支付额度，上限为300" /></div><p class="error_msg" data-node="error_msg"></p><div class="btn"><input value="确定" type="button" class="confirm" data-node="confirm" /><input value="取消" type="button" class="cancel" data-node="cancel" /></div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],PAGESIZE=10,countDown=0,dialog,$dialogEl,$errorMsg;module.exports=Widget.extend({el:"#user-left",events:{"click [data-node=withdraw]":"_withdraw","click [data-node=filter] li":"_timeChange","click [data-node=modify]":"_modify"},channels:{},init:function(t){var e=this;e.phonenum=t.data.pass_phone,e._initPagination(t.data.trans_total_count)},_withdraw:function(){window.location=window.urlPrefix+"/pay?qt=leftwithdrawview"},_timeChange:function(t){var e,a=this,n=$(t.currentTarget),o=n.data("value");a.$dom.filter.find("li").removeClass("active"),n.addClass("active"),$.ajax({url:"/pay?qt=getuserleft&display=json&time_type="+o,type:"GET",dataType:"json",success:function(t){0==t.error_no&&(e=t.result.trans_list,a.$dom.list.find("tbody").html(lefttmpl({transList:e,timeTxt:n.html()})),a._initPagination(t.result.trans_total_count))}})},_modify:function(){var t=this;dialog||(Dialog.disableKeyEvent(),dialog=new Dialog({html:limittmpl({countDown:countDown,phonenum:t.phonenum}),width:"auto",height:"auto"}),$dialogEl=dialog.getElement(),$errorMsg=$dialogEl.find("[data-node=error_msg]"),$dialogEl.on("click",function(t){t.stopPropagation()}),$dialogEl.on("keypress","[data-node=code],[data-node=account]",function(){$errorMsg.html("")}),$dialogEl.on("click","[data-node=confirm]",function(){var t=/^-?\d+\.?\d{0,2}$/,e=$.trim($dialogEl.find("[data-node=code]").val()),a=$.trim($dialogEl.find("[data-node=account]").val());t.test(e)&&e?!t.test(a)||0>=a?$errorMsg.html("支付额度有误，请重新填写"):a>300?$errorMsg.html("支付额度上限为300"):$.ajax({url:"/pay?qt=changeaccountlimit",dataType:"json",type:"POST",data:{limit_amount:a,ver_code:e},success:function(t){0==t.error_no?($errorMsg.html("恭喜您，您的支付额度已设置成功"),setTimeout(function(){window.location.reload()},1500)):$errorMsg.html(t.error_msg)}}):$errorMsg.html("验证码不正确")}),$dialogEl.on("click","[data-node=cancel]",function(){dialog.hide()}),$dialogEl.on("click","[data-node=send_code]",function(){var t=$(this);return t.hasClass("disabled")?void $errorMsg.html("发送次数过多"):void(0==countDown&&($dialogEl.find("[data-node=code]").val(""),$.ajax({url:"/pay?qt=sendvercode",dataType:"json",type:"GET",success:function(e){0==e.error_no?($errorMsg.html("发送成功"),countDown=60,_countDown(t)):114007==e.error_no?(t.addClass("disabled"),$errorMsg.html("发送次数过多")):$errorMsg.html(e.error_msg)}})))})),$dialogEl.find("[data-node=code]").val(""),$dialogEl.find("[data-node=account]").val(""),$errorMsg.html(""),dialog.show()},_initPagination:function(t){var e=this,a=e.$el.find("#recordPager");a.html("");var n=new PaginationStandard({total:t,pageSize:PAGESIZE,curPage:1,$container:a,showTotal:!1,showSelectPageSize:!1}),o="1";n.on("page",function(t){var a;o=e.$dom.filter.find("li").filter(".active").data("value"),$.ajax({url:"/pay?qt=getuserleft&display=json&page="+t.page+"&time_type="+o,type:"GET",dataType:"json",success:function(t){0==t.error_no&&(a=t.result.trans_list,e.$dom.list.find("tbody").html(lefttmpl({transList:a})))}})})}})});