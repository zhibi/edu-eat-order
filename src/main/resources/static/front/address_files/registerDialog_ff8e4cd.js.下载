define("waimai:widget/common/userinfo/comp/registerDialog",function(require,exports,module){var dialogTMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="logout-user-info-register-dialog-container fade">    <div class="register-dialog-content">        <div class="dialog-title">            <a class="dialog-close" data-node="registerDialogClose"></a>            <span class="title" data-node="title">',"undefined"==typeof data.title?"":baidu.template._encodeHTML(data.title),'</span>        </div>        <div class="dialog-body pass-form-container">            <div class="pass-form-item">                <label class="pass-label">手机号</label>                <input type="text" class="pass-text-input pass-text-input-phone" maxlength="11" autocomplete="off"                    placeholder="可用于登录和找回密码" >                <span class="pass-text-errmsg pass-text-errmsg-related"></span>            </div>            <div class="pass-form-item">                <label class="pass-label">密码</label>                <input type="password" class="pass-text-input  pass-text-input-password"                    placeholder="密码" autocomplete="off" >                <span class="pass-text-errmsg pass-text-errmsg-related"></span>            </div>            <div class="pass-form-item">                <label class="pass-label">确认密码</label>                <input type="password" class="pass-text-input  pass-text-input-repassword"                    placeholder="确认密码" autocomplete="off">                <span class="pass-text-errmsg pass-text-errmsg-related"></span>            </div>            <div class="pass-form-item">                <label class="pass-label pass-place"></label>                <span class="pass-explain" data-node="passExplain">VIP注册采用会员收费方式 会员费20元</span>            </div>            <div class="pass-form-item">                <label class="pass-label pass-place"></label>                <input type="button" class="pass-button pass-button-register-pay"                    value="注册并交费" data-node="passButtonRegisterPay" data-normal="false">            </div>            <div class="pass-form-item">                <label class="pass-label pass-place"></label>                <div class="pass-text-input pass-bottom-text">                    <a class="pass-normal-register" href="javascript:;" data-node="normalRegisterChange">普通用户注册</a>                </div>            </div>        </div>        <div class="dialog-bottom">        </div>    </div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];window.cookie=require("wcommon:static/util/Cookie");var defaultSettings={createId:"dialog-created-"+100*Math.random()},createdJson={},regs={isTel:/^1[3|4|5|7|8]\d{9}$/},validStragey={noEmpty:function(t){return t?!0:void 0},isTel:function(t){return regs.isTel.test(t)?!0:void 0},isEqual:function(t,e){return t===e?!0:void 0}},Valid=function(){this.stack=[]};Valid.prototype={constructor:Valid,add:function(){var t=[].slice.call(arguments);return this.stack.push(t),this},check:function(){var t=this.stack.length;if(t){for(var e,a,s=0;t>s;s++){var i=this.stack[s],o=i[0],l=validStragey[i[1]],n=i[2],r=i.splice(3);if(!l.apply(this,r)){a=o,e=n;break}}return this.clear(),e?{$el:a,msg:e}:void 0}},clear:function(){return this.stack=[],this}};var valid=new Valid,NORMAL_TEXT={title:"百度外卖账号注册",passExplain:"",passButtonRegisterPay:"注册并登录",normalRegisterChange:"vip用户注册"},VIP_TEXT={title:"百度外卖VIP账号注册",passExplain:"",passButtonRegisterPay:"注册并交费",normalRegisterChange:"普通用户注册"},RegisterDialog={urls:{loginPay:"/pay/loginpay"},channels:{},events:{"click [data-node=registerDialogClose]":"hideDialog","click [data-node=passButtonRegisterPay]":"registerSubmit","click [data-node=normalRegisterChange]":"registerChangeHandler","blur .pass-text-input":"inputBlur"},init:function(t){return this.cfg=this.cfg||{},$.extend(this.cfg,defaultSettings,t),createdJson[this.cfg.createId]?(this.show(),this):(createdJson[this.cfg.createId]=!0,this.render(t),this.initDom(),void this.show())},show:function(t){this.$el.show(),this.$el[0].offsetWidth,this.$el.addClass("in"),this.$el.trigger("show"),t&&t.call(this)},createMask:function(){},removeMask:function(){},hide:function(t){var e=this;this.$el.removeClass("in"),this.$el.trigger("hide"),setTimeout(function(){e.$el.hide()},300),t&&t.call(this)},hideDialog:function(){this.hide()},registerSubmit:function(t){var e=this.$dom.$phone,a=this.$dom.$password,s=this.$dom.$rePassword,i=($(t.currentTarget),e.val()),o=a.val(),l=s.val(),n=valid.add(e,"noEmpty","手机号不能为空",i).add(e,"isTel","请输入11位手机号",i).add(a,"noEmpty","密码不能为空",o).add(s,"noEmpty","确认密码不能为空",l).add(s,"isEqual","两次密码输入不一致",o,l).check();n?$.data(n.$el,"$related").text(n.msg).show().css("opacity","1"):(this.setCookie(),this.setLoginState({phoneValue:i}))},setCookie:function(){window.cookie.set("directorGeneralLogin",!0,{path:"/",expires:2592e6})},setLoginState:function(t){var e=t.phoneValue;this.vipRegister?this.goToPay({phoneValue:e}):($("#logout_user_info .logout_info").html("<li><a>已登录</a></li>"),this.hide())},vipRegister:!0,registerChangeHandler:function(){this.vipRegister=!this.vipRegister;var t=this.vipRegister;t?this.vipStateChange():this.normlStateChange()},vipStateChange:function(){this.$dom.$title.text(VIP_TEXT.title),this.$dom.$passExplain.parents(".pass-form-item").show(),this.$dom.$passButtonRegisterPay.val(VIP_TEXT.passButtonRegisterPay),this.$dom.$normalRegisterChange.text(VIP_TEXT.normalRegisterChange)},normlStateChange:function(){this.$dom.$title.text(NORMAL_TEXT.title),this.$dom.$passExplain.parents(".pass-form-item").hide(),this.$dom.$passButtonRegisterPay.val(NORMAL_TEXT.passButtonRegisterPay),this.$dom.$normalRegisterChange.text(NORMAL_TEXT.normalRegisterChange)},inputBlur:function(t){var e=$(t.currentTarget);this.setValidRelated([e]),$.data(e,"$related").css("opacity",0).hide().text("")},goToPay:function(t){var e={user_phone:t.phoneValue,total_amount:2e3,order_id:1,situation:"login",pay_supplier:2,shop_name:"登录支付活动",channel_from:"pc",pay_application:99};$.ajax({url:this.urls.loginPay,type:"GET",dataType:"JSON",data:e}).done(function(t){0===t.error_no?window.location.href=t.result.pay_url:alert(t.error_msg)}).fail(function(){})},render:function(t){var e=dialogTMPL({data:t}),a=this.cfg.createId;this.$el=$(e,"body"),this.$el.attr("id",a),this.el="#"+a,$("body").append(this.$el),this.$dom=this.$dom||{},this.$dom.$okButton="",this.$dom.$body=this.$el.find(".dialog-body"),this.$dom.$cancelButton=this.$el.find(".dialog-close"),this.$dom.$phone=this.$el.find(".pass-text-input-phone"),this.$dom.$password=this.$el.find(".pass-text-input-password"),this.$dom.$rePassword=this.$el.find(".pass-text-input-repassword"),this.setValidRelated([this.$dom.$phone,this.$dom.$password,this.$dom.$rePassword])},setValidRelated:function(t){for(var e=t.length,a=0;e>a;a++){var s=t[a];$.data(s,"$related",s.next(".pass-text-errmsg-related"))}},initDom:function(){var t=this,e=this.$el.find("[data-node]");this.$dom=this.$dom||{},e.each(function(e,a){var s=$(a),i=s.data("node");t.$dom["$"+i]=s})}};module.exports=Widget.extend(RegisterDialog)});