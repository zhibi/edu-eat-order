define("waimai:widget/common/userinfo/UserMgr",function(e,i,t){function o(e){var i=window.location.host;return e.test(i)?!0:void 0}var a=e("waimai:widget/common/userinfo/comp/registerDialog"),n=/waimai\.baidu\.com/g,s=o(n),r=$.Event;!function(i){function o(e){var t=m+(new Date).getTime(),e=e||{},o=e.url||i.location.href;if(sucCallBack=e.sucessCB||function(){},b){b.show();var a=$("#place-login-tips");a.length&&(u.getParam("tip")?a.show():u.mustTip||a.hide())}else{var n,s=function(){var e={tangram:!0,id:"login",cache:!0,apiOpt:{loginType:1,u:o,safeFlag:0,product:"waimai",is_voice_sms:1,qrcode:2,qrcode_animatin:1,overseas:0,staticPage:h},authsiteCfg:{act:"implicit",u:o},onSubmitStart:function(){u.getParam("purl")&&(n=i.open("about:blank"))},onLoginSuccess:function(e){var i=$.Event("onLoginSuccess");e.returnValue=!1,$.ajax({url:"https://passport.baidu.com/v3/login/api/auth/?return_type=5&tpl=waimai&u=https://waimai.baidu.com/waimai/setstoken",dataType:"jsonp",success:function(){sucCallBack(),$(u).trigger(i),i.isDefaultPrevented()?e.returnValue=!1:n&&(n.location.href=u.getParam("purl")),location.href=o},error:function(){sucCallBack(),$(u).trigger(i),i.isDefaultPrevented()?e.returnValue=!1:n&&(n.location.href=u.getParam("purl")),location.href=o}})},onSubmitedErr:function(){n&&n.close()}},t=window.passport||null;t&&t.pop&&(b=t.pop.init(e),b.show(),function(){var e=$("#passport-login-pop"),i=arguments,t=(u.getParam("purl"),u.getParam("tip")),o=u.getParam("title");e.length&&t?setTimeout(function(){$('<div id="place-login-tips" class="place-login-tips">'+t+"</div>").appendTo(e),o&&e.find("#TANGRAM__PSP_2__titleText").text(o)},100):setTimeout(function(){i.callee()},10)}())};$.ajax({url:t,type:"get",dataType:"script",crossDomain:!0,data:null,async:!0,error:function(){location.reload()},success:function(){s()}})}}function n(e){if(!e)return"";var i="",t=e.uName||e.displayname,o=e.email,a=e.mobile;t?i=t:(o||a)&&(i=o||a);var n="";/qt=find/.test(location.href)&&(n='<li class="uname"> <a href="/waimai?qt=contact" class="contract ">联系我们</a></li>');var s=['<ul class="login_info">'+n+'<li id="usernameInfo" class="uname mn-lk-w">'];return s.push(t?'<a id="username" class="mn-lk" href="/waimai/trade/orderlist">你好，'+i+"</a>":'<a id="username" class="mn-lk" href="https:/passport.baidu.com/v2/?ucenteradduname">'+i+"</a>"),s.push('<div id="popUserInfoId" class="mn-tip"><div class="top-arrow"></div><ul class="mn">'),s.push('<li><a class="my-info" href="/waimai?qt=orderlist&type=wait"><span class="icon order-icon"></span>我的订单</a></li>'),s.push('<li><a class="my-info" href="/waimai?qt=addressmanage&type=select"><span class="icon address-icon"></span>送餐地址</a></li>'),s.push('<li><a class="my-info" href="/waimai?qt=myfavorite"><span class="icon favorite-icon"></span>收藏夹</a></li>'),s.push('<li><a class="my-info" href="/waimai?qt=couponinfo"><span class="icon coupon-icon"></span>代金券</a></li>'),s.push('<li><a class="my-info" href="/pay?qt=getuserleft"><span class="icon left-icon"></span>我的余额</a></li>'),s.push('<li><a class="my-info" href="/trade/refundlist"><span class="icon refund-icon"></span>我的退款</a></li>'),s.push('<li><a id="logout" class="logout" href="javascript:void(0)"><span class="icon account-icon"></span>退出</a></li>'),s.push("</ul></div>"),s.join("")}function l(e,i){var t="",o=i?"&"+encodeURIComponent(i):"";switch(e){case"login":t=d+g;break;case"logout":t=f}return c+t+p+encodeURIComponent(o)}var u,c="https://passport.baidu.com",d="v2/",p="&tpl=ma",g="?login",f="?logout";T_ORDER_LIST=['<ul class="order-list">','<li><a target="_blank" class="order-list-cater" href="/detail?qt=orderlist&type=cater&detail=order_list">餐饮订单</a></li>','<li><a target="_blank" class="order-list-movie" href="/detail?qt=orderlist&type=movie">电影订单</a></li>',"</ul>"].join("");var m=c+"/passApi/js/uni_login_wrapper.js?cdnversion=",h=i.location.origin+"/static/common/widget/userinfo/v3Jump.html",v="/waimai/checklogin",_="1",w={},b=null,y=!1;u={init:function(){var e;y||(this.update({onsuccess:function(){}}),$("#user_info").delegate(".book-order","mouseenter.order",function(){var i,t=$(this).find(".order-list");i=u.userState&&u.userState.isOnline||"0",e&&clearTimeout(e),0==t.length&&(t=$(this).append($(T_ORDER_LIST))),t.show(),t.find(".order-list-hotel").attr("stat","click|{da_src:inf.order_hotel, user: "+i+"}")}).delegate(".book-order","mouseleave.order",function(){var i=$(this).find(".order-list");i.length>0&&(e=setTimeout(function(){i.hide()},50))}),y=!0)},setSearchOrder:function(e){$(this).on("setlogin",function(){$("#user_info .book-order").html(e)}),$("#user_info .book-order").html(e),setTimeout(function(){$("#user_info").undelegate(".book-order","mouseenter.order").undelegate(".book-order","mouseleave.order")},100)},update:function(e){e=e||{},this.getState(function(i){if(i){u.userState=i;var t=this,o=e.onsuccess,a=e.scope;if(i.isOnline&&(i.displayname||"")+(i.email||"")+(i.mobile||"")){if(t.isLogin(i),!s){var n=r("isLogin",{userIsLogin:!0,userState:i});$(document.body).trigger(n)}}else if(t.isLogout(i),!s){var l=r("breforeCreateRegister",{userMgr:t});$(document.body).trigger(l);var c=cookie.get("directorGeneralLogin");c?$("#logout_user_info .logout_info").html("<li><a>已登录</a></li>"):t.createRegisterDialog();var d=r("isLogout",{});$(document.body).trigger(d)}e&&o&&a&&o.call(a,i)}})},getState:function(i){window.cookie=e("wcommon:static/util/Cookie"),$.ajax({url:"https://passport.baidu.com/v3/login/api/auth/?return_type=5&tpl=waimai&u=https://waimai.baidu.com/waimai/setstoken",dataType:"jsonp",error:function(){$.ajax({url:v,dataType:"json",success:function(e){u._getState(e)}})}}),this._getStateCBK=i},_getState:function(e){e&&this._getStateCBK&&this._getStateCBK(e)},bindEvents:function(){var e=this,t=function(){e.tipTimer=setTimeout(function(){$("#popUserInfoId").css("visibility","hidden")},200)};$("#username").on("mouseover",function(){$("#popUserInfoId").css({display:"none",visibility:"visible"}).fadeIn()}),$("#popUserInfoId").on("mouseover",function(){i.clearTimeout(e.tipTimer)}),$("#username").on("mouseout",t),$("#popUserInfoId").on("mouseout",t),$("#logout").on("click",function(){return u.logout(),!1})},addLoginEvt:function(){var e=this;$("#login, #login-buttom").off("click").on("click",function(i){i.stopPropagation(),i.preventDefault(),e.removeAll(),e.login()})},addRegisterEvt:function(){var e=this;$("#logout_user_register").off("click").on("click",function(i){return s?!0:(i.stopPropagation(),i.preventDefault(),void e.createRegisterDialog())})},createRegisterDialog:function(){this.RegisterDialogWidget?this.RegisterDialogWidget.show():this.RegisterDialogWidget=a.createWidget({title:"百度外卖VIP账号注册",createId:"logout_user_register_create"})},login:function(e){e=e||{},u.userState.isOnline&&u.userState.isOnline==_&&(u.userState.displayname||"")+(u.userState.email||"")+(u.userState.mobile||"")?e.url&&(location.href=e.url):o(e)},logout:function(){$.ajax({url:"/waimai/clearstoken",dataType:"json"}),i.location.href=l("logout",{u:i.location.href})},isLogin:function(e){var i=this,t=$("#logout_user_info"),o=$("#login_user_info");t.length&&t.hide(),o.length&&(o.show(),o.html(n(e))),$(i).trigger("setlogin"),this.bindEvents()},isLogout:function(){var e=$("#logout_user_info"),i=$("#login_user_info");e&&e.show(),i&&i.hide();var t="";/qt=find/.test(location.href)&&(t='<li> <a href="/waimai?qt=contact" class="contract">联系我们</a> </li>'),$(".logout_info").prepend(t),this.addLoginEvt(),this.addRegisterEvt()},clickPage:function(e,i){"normal"==e?($("#loginIframe_iph"+i).hide(),$("#passports"+i).show(),$("#normal_login"+i).addClass("login_hover"),$("#phone_login"+i).removeClass("login_hover")):"iph"==e&&($("#loginIframe_iph"+i).show(),$("#passports"+i).hide(),$("#phone_login"+i).addClass("login_hover"),$("#normal_login"+i).removeClass("login_hover"))},setParam:function(e,i){w[e]=i},getParam:function(e){return w[e]},removeParam:function(e){for(var i,t=0;i=e[t];t++)delete w[i]},removeAll:function(){w={}}},t.exports=u}(window)});