define("waimai:widget/common/ui/feedback/feedback",function(require,exports,module){function Feedback(e){$.extend(opt,e),bindEvent(),initContent()}function bindEvent(){var e=opt.$el;e.on("saveSuccess",function(){opt.saveSuccess(e)}),e.on("click",".submitBtn",function(){commitForm()}),e.on("focus",".input",function(){var e=$(this).attr("name");removeError(e)})}function initContent(){var e=feedbackTmpl();opt.$el.append(e)}function showError(e,t){var a=opt.$el;a.find("[name='"+e+"']").parent().next().removeClass("v-hide").text(t)}function removeError(e){var t=opt.$el;t.find("[name='"+e+"']").parent().next().addClass("v-hide").empty()}function commitForm(){var e=opt.$el,t=CookieDataCenter.getAddr(),a=window.location.href,n=t.lat,o=t.lng,r=e.find("[name='content']").val(),i=e.find("[name='contact']").val(),c="pc";return $.trim(r)?r.length>800?void showError("content","功能建议最多不能超过800个字"):checkContact(i)?void $.ajax({url:FEEDBACK_AJAX,type:"POST",dataType:"json",data:{url:a,lat:n,lng:o,content:r,contact:i,from:c},success:function(t){return 0==t.error_no?(e.trigger("saveSuccess"),void LISTENER.trigger("waimai-contact-feedback","feedback",{succ:!0})):(GlobalTips.tip(t.error_msg),!1)},error:function(){GlobalTips.tip("操作失败1")}}):void showError("contact","请填写正确的联系方式"):void showError("content","请填写功能建议")}function checkContact(e){var t=/(@.*@)|(\.\.)|(@\.)|(\.@)|(^\.)/,a=/^.+\@(\[?)[a-zA-Z0-9\-\.]+\.([a-zA-Z]{2,3}|[0-9]{1,3})(\]?)$/,n=/^1[3|4|5|7|8][0-9]\d{8}$/,o=/^0[\d]{2,3}-[\d]{7,8}/;return $.trim(e)?!t.test(e)&&a.test(e)?!0:n.test(e)?!0:o.test(e)?!0:!1:!1}var GlobalTips=require("waimai:static/utils/GlobalTips"),CookieDataCenter=require("waimai:static/utils/CookieDataCenter"),FEEDBACK_AJAX="/waimai?qt=feedback",feedbackTmpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="feedback-wrap">    <div class="f-form">        <div class="form-group">            <label>功能建议：</label>            <div class="input-control">                <textarea name="content" placeholder="百度外卖还在不断完善和成长，我们真诚的期望听到您的反馈和建议" class="input placeholder-con"></textarea>            </div>            <div class="error-msg v-hide"></div>        </div>        <div class="form-group">            <label>联系方式：</label>            <div class="input-control">                <input type="text" name="contact" placeholder="请留下您的手机号或邮箱" class="input placeholder-con"/>            </div>            <div class="error-msg  v-hide"></div>        </div>        <div class="form-submit">            <input type="button" value="提交" class="submitBtn"/>            <input type="button" value="取消" class="cancelBtn versa"/>        </div>    </div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],LISTENER=window.listener,opt={$el:null,saveSuccess:null};module.exports=Feedback});