;/*!waimai:page/menu.js*/
define("waimai:page/menu",function(require,exports,module){function changeBear(){var t=1*cartDC.getAmount().productAmount,e=1*cartDC.getAmount().packFee,a=1*cartDC.getAmount().takeOutPrice,i=(t+e)/a,r="block"==$fill_diff.css("display")?!0:!1;if(r)if("right"==$fill_diff_bear.attr("status")){var d=$fill_diff.attr("state");"non-trigger"==d&&$fill_diff_bear.trigger("click")}else if(N>i||i>1)$fill_diff.css("display","none");else{var n=cartDC.getAmount(),f=cartDC.fetchItems();$.ajax({type:"POST",dataType:"json",url:"/shopui?qt=supplementary",data:{priceDifference:n.cha,wid:f.shop_id,products:f.products},success:function(t){0==t.error_no&&0!=t.result.length?($fill_diff_table_menu.html(fill_diff_table_data_menu({data:t.result})),new Tip({targets:".fill_diff_name",className:"fill_diff_name_hover",trigger:"hover",targetType:"top",offset:{top:0,left:0}})):$fill_diff.css("display","none")}})}else if(i>=N&&1>i){var n=cartDC.getAmount(),f=cartDC.fetchItems();$.ajax({type:"POST",dataType:"json",url:"/shopui?qt=supplementary",data:{priceDifference:n.cha,wid:f.shop_id,products:f.products},success:function(t){0==t.error_no&&0!=t.result.length&&($fill_diff_table_menu.html(fill_diff_table_data_menu({data:t.result})),$fill_diff.css("display","block"),addNStat({da_src:"displayBk",da_act:"show"}),new Tip({targets:".fill_diff_name",className:"fill_diff_name_hover",trigger:"hover",targetType:"top",offset:{top:0,left:0}}))}})}}function itemTotal(){for(var t=0,e=0;e<$("input.item-count").length;e++)t+=1*$("input.item-count").eq(e).val();return t}var cartDC=require("waimai:static/utils/CartDataCenter"),filter=require("waimai:widget/menu/filter/filter"),list=require("waimai:widget/menu/list/list"),cart=require("waimai:widget/common/menucommon/cart/cart"),Browser=require("wcommon:static/util/Browser"),AddToCartAnim=require("waimai:widget/common/menucommon/cart/AddToCartAnim"),Tip=require("jsmod/ui/fixElement/tip"),cookie=require("wcommon:static/util/Cookie"),GlobalTips=require("waimai:static/utils/GlobalTips"),$fill_diff=$("#fill_diff-section"),$fill_diff_bear=$("#fill_diff_bear"),$fill_diff_table_menu=$("#fill_diff_table"),fill_diff_table_data_menu=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("<table>    ");for(var i=0;i<data.length;i++)_template_fun_array.push("    "),1==data[i].length?_template_fun_array.push('    <tr>        <td class="fill_diff_name" data-content="',"undefined"==typeof data[i][0].name?"":baidu.template._encodeHTML(data[i][0].name),'">            <span class="fill_diff_item" haveAttr="',"undefined"==typeof data[i][0].have_attr?"":baidu.template._encodeHTML(data[i][0].have_attr),'" itemid="',"undefined"==typeof data[i][0].id?"":baidu.template._encodeHTML(data[i][0].id),'" attrid="',"undefined"==typeof data[i][0].attr_id?"":baidu.template._encodeHTML(data[i][0].attr_id),'">',"undefined"==typeof data[i][0].name?"":baidu.template._encodeHTML(data[i][0].name),'</span>        </td>        <td class="fill_diff_price">            <span>¥',"undefined"==typeof data[i][0].current_price.toFixed(1)?"":baidu.template._encodeHTML(data[i][0].current_price.toFixed(1)),'</span>        </td>        <td class="fill_diff_add" item="1">            <span></span>        </td>    </tr>        '):2==data[i].length&&_template_fun_array.push('    <tr>        <td class="fill_diff_name" data-content="',"undefined"==typeof data[i][0].name?"":baidu.template._encodeHTML(data[i][0].name),"+","undefined"==typeof data[i][1].name?"":baidu.template._encodeHTML(data[i][1].name),'">            <span class="fill_diff_item_1" haveAttr="',"undefined"==typeof data[i][0].have_attr?"":baidu.template._encodeHTML(data[i][0].have_attr),'" itemid="',"undefined"==typeof data[i][0].id?"":baidu.template._encodeHTML(data[i][0].id),'" attrid="',"undefined"==typeof data[i][0].attr_id?"":baidu.template._encodeHTML(data[i][0].attr_id),'">',"undefined"==typeof data[i][0].name?"":baidu.template._encodeHTML(data[i][0].name),'</span>            <span class="fill_diff_item_plus">+</span>            <span class="fill_diff_item_2" haveAttr="',"undefined"==typeof data[i][1].have_attr?"":baidu.template._encodeHTML(data[i][1].have_attr),'" itemid="',"undefined"==typeof data[i][1].id?"":baidu.template._encodeHTML(data[i][1].id),'" attrid="',"undefined"==typeof data[i][1].attr_id?"":baidu.template._encodeHTML(data[i][1].attr_id),'">',"undefined"==typeof data[i][1].name?"":baidu.template._encodeHTML(data[i][1].name),'</span>        </td>        <td class="fill_diff_price">            <span>¥',"undefined"==typeof(1*data[i][0].current_price+1*data[i][1].current_price).toFixed(1)?"":baidu.template._encodeHTML((1*data[i][0].current_price+1*data[i][1].current_price).toFixed(1)),'</span>        </td>        <td class="fill_diff_add" item="2">            <span></span>        </td>    </tr>    '),_template_fun_array.push("    ");_template_fun_array.push("</table>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],N=.6;$(filter).bind("click.filter",function(t,e){list.jumpToMenu(e.index,e.offset)}),$(list).bind("scroll",function(t,e){Browser.msie&&"6.0"==Browser.version||filter.setCurMenu(e)}),$(list).bind("addItem",function(t,e){if(itemTotal()+1>999)return void GlobalTips.tip("所点菜品数量过多");var a,i;cartDC.setCarItem(e),cartDC.fetchPremium(),a=$("[data-sid='item_"+e.itemId+"']").find("figure div"),i=$(".cart-section .cart-bar").offset();var r="none"==$("#fill_diff_table").css("display")?!0:!1;a.length&&i&&r&&AddToCartAnim.addAnim(a.eq(0),i,{width:"210px",height:"210px",zIndex:801}),changeBear()}),$(list).bind("minusItem",function(t,e){cartDC.setCarItem(e),cartDC.fetchPremium(),changeBear()}),$(cartDC).bind("premium.shopCar",function(t,e){cart.addPremium(e),cart.addBoxPrice(e)}),$(cartDC).bind("failpremium.shopCar",function(){cart.setLocalPrice(cartDC.getAmount().productAmount)}),$(cartDC).bind("delete.shopCar",function(t,e){list.setItemStockStatus(e),list.clearItemStatus(e),cart.delItem(e),cart.setAmount(cartDC.getAmount())}),$(cartDC).bind("update.shopCar",function(t,e){list.setItemStockStatus(e),list.setItemStatus(e),cart.updateItem(e),cart.setItemStockStatus(e),cart.setAmount(cartDC.getAmount())}),$(cartDC).bind("add.shopCar",function(t,e){list.setItemStockStatus(e),list.setItemStatus(e),cart.addItem(e),cart.setItemStockStatus(e),cart.setAmount(cartDC.getAmount())}),$(cartDC).bind("clear.shopCar",function(){list.clearItemStatus(),cart.clearCart()}),$(cartDC).bind("features.stockTight",function(t,e){cart.setFeatureStockTight(e)}),$(cartDC).bind("features.stockNormal",function(t,e){cart.setFeatureStockNormal(e)}),$(cartDC).bind("inited.shopCar",function(t,e){cartDC.resetCar(list.checkCarItem(e.shopItem)),list.setItemStockStatus(e.shopItem),list.setItemStatus(e.shopItem),cart.addItem(e.shopItem),cart.setItemStockStatus(e.shopItem),cart.setAmount(cartDC.getAmount())}),$(cart).bind("update.cart",function(t,e){cartDC.setCarItem(e),cartDC.fetchPremium(),changeBear()}),$(cart).bind("clear.cart",function(){list.removeItemStockTight(cartDC.getCarItems()),cartDC.clearCar(),changeBear()}),module.exports={init:function(t){cartDC.init(t)},setCurShopInfo:function(t,e,a,i,r){1!=r&&4!=r&&(cartDC.init(t),cartDC.setCurShopInfo(t,e,a,i),cartDC.fetchPremium(),this.initFillDiff())},initFillDiff:function(){var t=(1*cartDC.getAmount().productAmount+1*cartDC.getAmount().packFee)/cartDC.getAmount().takeOutPrice*1;if(t>=N&&1>t){var e=cartDC.getAmount(),a=cartDC.fetchItems();$.ajax({type:"POST",dataType:"json",url:"/shopui?qt=supplementary",data:{priceDifference:e.cha,wid:a.shop_id,products:a.products},success:function(t){0==t.error_no&&0!=t.result.length&&($fill_diff_table_menu.html(fill_diff_table_data_menu({data:t.result})),$fill_diff.css("display","block"),addNStat({da_src:"displayBk",da_act:"show"}),new Tip({targets:".fill_diff_name",className:"fill_diff_name_hover",trigger:"hover",targetType:"top",offset:{top:0,left:0}}))}})}}}});