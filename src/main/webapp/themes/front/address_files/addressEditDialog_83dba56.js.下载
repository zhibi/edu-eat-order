define("waimai:widget/common/ui/addressEditDialog/addressEditDialog",function(require,exports,module){var Dialog=require("jsmod/ui/dialog"),cookie=require("wcommon:static/util/Cookie"),detailTeml=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="addr-detail new-address-section1">    <form>        <table class="addr-table" border="0">            <tr>                <td valign="top"><span class="l-label">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名</span></td>                <td>                    <input type="hidden" value="',"undefined"==typeof data.id?"":baidu.template._encodeHTML(data.id),'" name="adrr_id">                    <div class="form-group">                        <div class="input-control">                            <input type="text" name="user_name" placeholder="您的姓名" value="',"undefined"==typeof data.user_name?"":baidu.template._encodeHTML(data.user_name),'" class="placeholder-con">                            <span class="star">*</span>                        </div>                        <div class="error-msg v-hide">请填写您的姓名，不能超过8个字符</div>                    </div>                    <div class="form-group">                        <div class="input-control">                                                        <input type="hidden" name="gender" value="',"undefined"==typeof(data.gender?data.gender:1)?"":baidu.template._encodeHTML(data.gender?data.gender:1),'">                            <div class="s-gender '),(1===parseInt(data.gender,10)||isNaN(parseInt(data.gender,10)))&&_template_fun_array.push(" selected "),_template_fun_array.push('" data-gender="1"  >                                <i></i><span>先生</span>                            </div>                            <div class="s-gender '),2==data.gender&&_template_fun_array.push(" selected "),_template_fun_array.push('" data-gender="2">                                <i></i><span>女士</span>                            </div>                        </div>                        <div class="error-msg v-hide">请选择您的性别</div>                    </div>                </td>            </tr>            <tr>                <td valign="top"><span class="l-label">电&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;话</span></td>                <td>                    <div class="form-group">                        <div class="input-control">                            <input type="text" name="user_phone" placeholder="11位手机号" value="',"undefined"==typeof data.user_phone?"":baidu.template._encodeHTML(data.user_phone),'" class="placeholder-con">                            <span class="star">*</span>                        </div>                        <div class="error-msg v-hide">请填写正确的手机号</div>                    </div>                </td>            </tr>            <tr>                <td valign="top"><span class="l-label">位&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;置</span></td>                <td>                    <div class="form-group">                        <div class="input-control poi_address">                            <i class="addr-icon-input"></i>                            <input type="text" name="sug_address" placeholder="请输入小区、大厦或学校" value="',"undefined"==typeof data.sug_address?"":baidu.template._encodeHTML(data.sug_address),'" class="placeholder-con poi_address1">                            <span class="star">*</span>                                                        <input type="hidden" name="hide_sug_address" value="',"undefined"==typeof data.lng?"":baidu.template._encodeHTML(data.lng),"-","undefined"==typeof data.lat?"":baidu.template._encodeHTML(data.lat),'" class="hide_poi_address1">                        </div>                        <div class="error-msg v-hide">请输入地址并在下拉框中进行选择</div>                        <div class="s-search-container2"></div>                                            </div>                </td>            </tr>            <tr>                <td valign="top"><span class="l-label">详细地址</span></td>                <td>                    <div class="form-group">                        <div class="input-control">                                                        <input type="text" name="detail_address" placeholder="请输入门牌号等详细信息" value="',"undefined"==typeof data.detail_address?"":baidu.template._encodeHTML(data.detail_address),'" class="placeholder-con">                        </div>                        <div class="error-msg v-hide">请输入门牌号等详细信息</div>                    </div>                </td>            </tr>        </table>        <div class="form-group form-submit">            <input type="button" class="saveBtn" data-node="saveBtn" value="'),confirmTxt?_template_fun_array.push("","undefined"==typeof confirmTxt?"":baidu.template._encodeHTML(confirmTxt),""):_template_fun_array.push("保存"),_template_fun_array.push('">            '),noCancel||_template_fun_array.push('                <input type="button" class="escBtn versa" value="取消">            '),_template_fun_array.push("        </div>    </form></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],GlobalTips=require("waimai:static/utils/GlobalTips"),superTip=require("waimai:static/utils/superTip"),cacheDialog;window.NOBLUR="NOPE";var CookieDataCenter=require("waimai:static/utils/CookieDataCenter"),SearchForSug=require("waimai:widget/common/ui/search/search"),ADD_AJAX="/waimai?qt=addressmanage&type=add&display=json",UPDATE_AJAX="/waimai?qt=addressmanage&type=update&display=json",AddressEditDialog=function(){};$.extend(AddressEditDialog.prototype,{opt:{},setTipFlag:function(){cookie.setRaw("sug_address_input_tip_flag",1,{path:"/"})},getTipFlag:function(){return cookie.get("sug_address_input_tip_flag")},showTip:function(){var e=this.getTipFlag();this.opt.showSuperTip&&1!=e&&(this.setTipFlag(),this.opt.superTip=superTip.create({hostSelector:this.cacheDialog.content.find("[name=sug_address]"),autoOpen:!0,autoClose:!0,showTime:3e3,msg:"在这里输入并进行选择",borderRadius:5,triangleColor:"#ddcc9c",position:{my:"top left",at:"bottom left"},offset:{x:15,y:-8}},{display:"none","background-color":"rgba(254, 248, 222, 0.9)","background-color\x00":"rgb(254, 248, 222)\x00","font-size":"14px",color:"#333","line-height":"1.4","z-index":"1000",border:"solid 1px #ddcc9c"}))},bindEvent:function(){var e=this;$(this).off("dialogShow").on("dialogShow",function(){e.showTip()}),this.opt.$detailEl&&this.opt.$detailEl.undelegate(".saveBtn","click").delegate(".saveBtn","click",function(){e.saveAddress()}).undelegate(".escBtn","click").delegate(".escBtn","click",function(){e.opt.superTip&&e.opt.superTip.remove(),e.cacheDialog.hide({fade:!0})}),$(this).off("saveSuccess").on("saveSuccess",function(t,a){if(this.opt.saveSuccess)this.opt.saveSuccess(e,a);else{if(e.cacheDialog.hide({fade:!0}),window.Search.resetMyAddress(),this.opt.isGoSearch){var i=window.Search.goShopList(a,!0);return window.Search.setDefaultAddress(a.id),void(window.location.href=i)}window.Search.setDefaultAddress(a.id),this.successTip("保存成功，正在刷新..."),setTimeout(function(){window.location.reload()},1500)}})},initSugEvent:function(e){var t=this,a=e,i=a.find(".s-search-container2"),s=a.find(".poi_address1"),d=a.find(".poi_address1"),n=a.find(".hide_poi_address1"),r={$resultEl:i,$searchConEl:s,showHistoryTrg:"address.show.history",hideHistoryTrg:"address.hide.history",NOListLiJump:"NOPE",$hiddenSearchPOI:n};SearchForSug.init(r),d.off("click").on("click",function(e){t.showSearch(a),e.stopPropagation()}),$(".mod-dialog-wrap").off("click").on("click",function(e){i.hide(),e.stopPropagation()}),s.off("blur").on("focus",function(){t.opt.superTip&&t.opt.superTip.elem.remove()}),s.off("blur").on("blur",function(){"NOPE"==window.NOBLUR&&t.checkForm("SUG")})},showSearch:function(e){var t=e.find(".poi_address1");t.focus(),$(Search).trigger("hide.history")},bindGenderEvent:function(e){e.on("click",".s-gender",function(){if(!$(this).hasClass("selected")){$(".s-gender").removeClass("selected"),$(this).addClass("selected");var e=$(this).attr("data-gender");$(this).parent().find("[name='gender']").val(e)}})},showDetailDialog:function(e,t,a){var i=e?e:{},s=detailTeml({data:i,noCancel:!1,confirmTxt:"保存"});this.cacheDialog=new Dialog({html:s,width:560,height:400}),this.cacheDialog.show({fade:!0}),this.opt.$detailEl=$(".addr-detail.new-address-section1"),$(".placeholder-con").placeholder(),this.bindGenderEvent(this.opt.$detailEl),this.opt.isGoSearch=t,this.opt.showSuperTip=a,this.bindEvent(),$(this).trigger("dialogShow"),this.initSugEvent(this.opt.$detailEl)},saveAddress:function(){var e=this;if(this.errorHide(),this.checkForm()){var t=this.getFormData();t.bdstoken=$("#bdstoken")[0].value;var a=t.id?UPDATE_AJAX:ADD_AJAX;try{$.ajax({url:a,type:"POST",dataType:"json",data:t,context:this,success:function(a){if(0==a.error_no)t.__type=t.id?"update":"add",t.id=t.id||a.result.id||"",$(e).trigger("saveSuccess",t);else{var i=a.error_msg?a.error_msg:"服务器累了，请稍后重试";this.errorTip(i)}}})}catch(i){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"waimai:widget/common/ui/addressEditDialog/addressEditDialog.js",ln:217})}}},checkForm:function(e){var t=e?1:0;if(t){var a=this.getInputValue("sug_address"),i=this.opt.$detailEl.find(".hide_poi_address1")[0].value;return(!$.trim(a)||a.length>40||!i)&&this.errorShow("sug_address"),!1}var s=this.getInputValue("user_name");if(!$.trim(s)||s.length>8)return this.errorShow("user_name"),!1;var d=this.getInputValue("gender");if(!d)return this.errorShow("gender"),!1;var n=this.getInputValue("user_phone");if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(n))return this.errorShow("user_phone"),!1;var a=this.getInputValue("sug_address"),i=this.opt.$detailEl.find(".hide_poi_address1")[0].value;return!$.trim(a)||a.length>40||!i?(this.errorShow("sug_address"),!1):!0},getFormData:function(){for(var e=this.opt.$detailEl.find(".input-control"),t={},a=0,i=e.length;i>a;a++){var s=e.eq(a),d=s.find("input").length?s.find("input").attr("name"):s.find("textarea").attr("name");t[d]=this.getInputValue(d)}t.id=this.getInputValue("adrr_id");var n=e.find(".hide_poi_address1")[0].value;return t.lng=n.split("-")[0]?n.split("-")[0]:"",t.lat=n.split("-")[1]?n.split("-")[1]:"",t.location=n,t.address=t.sug_address+" "+t.detail_address,t},successTip:function(e){GlobalTips.tip(e)},errorTip:function(e){GlobalTips.tip(e)},errorShow:function(e){this.opt.$detailEl.find("[name='"+e+"']").parent().next().removeClass("v-hide"),this.opt.$detailEl.find("[name='"+e+"']").addClass("caution-line"),this.errorHide(2500,e)},errorHide:function(e,t){var e=e?e:0,t=t?t:"";return e?void setTimeout(function(){$(".error-msg").addClass("v-hide"),t&&$("[name='"+t+"']").removeClass("caution-line")},e):void $(".error-msg").addClass("v-hide")},getInputValue:function(e){var t=this.opt.$detailEl.find("[name='"+e+"']"),a=t.get(0).tagName.toLowerCase(),i=t.attr("type"),s=function(){var t=$(" input[name='"+e+"']").filter(":checked");return t.length?t[0].value:null},d=function(){var t=[],a=$(" input[name='"+e+"']:checkbox");if(len=a.length,len>0)for(var i=0;len>i;i++)a[i].checked&&t.push(a[i].value);return t},n=function(){return t[0].value};switch(a){case"input":switch(i){case"radio":return s();case"checkbox":return d();default:return n()}break;case"select":return n();case"textarea":return n();default:return null}},addFormHtml:function(){return detailTeml({data:{},noCancel:!0,confirmTxt:"保存送餐信息"})},updateOpt:function(e){this.opt=$.extend({},this.opt,e)}}),module.exports=new AddressEditDialog});