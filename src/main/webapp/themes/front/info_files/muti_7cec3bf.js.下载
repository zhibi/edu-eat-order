define("waimai:widget/common/ui/muticities/muti",function(require,exports,module){function Muti(){this.$el=$("#muti-aois"),this.aois={}}function getQueryString(e,t){var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=t.match(i);return null!=a?unescape(a[2]):null}var CookieDataCenter=require("waimai:static/utils/CookieDataCenter"),citiesTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="cities" data-node="cities">    '),maybe_city.name&&_template_fun_array.push('    <div class="guess-city">        <dl>            <dt>猜你在</dt>            <dd>                <a data-node="nav_city" href="javascript:void(0);" data-cityid="',"undefined"==typeof maybe_city.code?"":baidu.template._encodeHTML(maybe_city.code),'" data-hasAoi="',"undefined"==typeof maybe_city.isHaveAoi?"":baidu.template._encodeHTML(maybe_city.isHaveAoi),'">',"undefined"==typeof maybe_city.name?"":baidu.template._encodeHTML(maybe_city.name),"</a>            </dd>        </dl>    </div>    "),_template_fun_array.push("    ");for(var i in city_list){_template_fun_array.push('    <dl class="cities-group">        <dt>            ',"undefined"==typeof i?"":baidu.template._encodeHTML(i),"        </dt>        <dd>            <ul>            ");for(var j in city_list[i])_template_fun_array.push('                <li>                    <a data-node="nav_city" href="javascript:void(0);" data-cityid="',"undefined"==typeof city_list[i][j].code?"":baidu.template._encodeHTML(city_list[i][j].code),'" data-hasAoi="',"undefined"==typeof city_list[i][j].isHaveAoi?"":baidu.template._encodeHTML(city_list[i][j].isHaveAoi),'" title="',"undefined"==typeof city_list[i][j].name?"":baidu.template._encodeHTML(city_list[i][j].name),'">                        ',"undefined"==typeof city_list[i][j].name?"":baidu.template._encodeHTML(city_list[i][j].name),"                    </a>                </li>            ");_template_fun_array.push("            </ul>        </dd>    </dl>    ")}_template_fun_array.push("</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],aoisTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="aois" data-node="aois">    ');for(var i in aois){_template_fun_array.push('    <dl class="aoi-group">        <dt>',"undefined"==typeof i?"":baidu.template._encodeHTML(i),"</dt>        <dd>            <ul>            ");for(var j in aois[i])_template_fun_array.push('                <li>                    <a title="',"undefined"==typeof aois[i][j].name?"":baidu.template._encodeHTML(aois[i][j].name),'" data-node="nav_aoi" href="/waimai?qt=shoplist&lat=',"undefined"==typeof aois[i][j].lat?"":baidu.template._encodeHTML(aois[i][j].lat),"&lng=","undefined"==typeof aois[i][j].lng?"":baidu.template._encodeHTML(aois[i][j].lng),"&address=","undefined"==typeof aois[i][j].name?"":baidu.template._encodeHTML(aois[i][j].name),"&city_id=","undefined"==typeof city_id?"":baidu.template._encodeHTML(city_id),'">                        ',"undefined"==typeof aois[i][j].name?"":baidu.template._encodeHTML(aois[i][j].name),"                    </a>                </li>            ");_template_fun_array.push("            </ul>        </dd>    </dl>    ")}_template_fun_array.push("</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];$.extend(Muti.prototype,{init:function(){var e=this;e.initEvents()},initCities:function(){var e=this;e.showCities()},initEvents:function(){var e=this;e.$el.on("click",function(e){e.stopPropagation()}),e.$el.delegate('[data-node="nav_city"]',"click",function(e){var t=$(e.currentTarget),i=t.data("cityid"),a=$.trim(t.html()),n=t.data("hasaoi"),o={name:a,code:i,hasaoi:n};CookieDataCenter.setCity(o),listener.trigger("muticities","selected",o),e.stopPropagation()}),e.$el.delegate('[data-node="nav_aoi"]',"click",function(e){var t=$(e.currentTarget),i=$.trim(t.html()),a=/(\/shopinterface)|(\/activity)/;if(a.test(window.location.pathname)){var n=getQueryString("lng",t.attr("href")),o=getQueryString("lat",t.attr("href")),d=getQueryString("address",t.attr("href"));return CookieDataCenter.setAddr({lng:n,lat:o,address:d}),window.location.reload(),!1}listener.trigger("mutiaois","selected",{aoiname:i}),e.stopPropagation()}),listener.on("city","select",function(){e.hide(),e.showCities(),listener.trigger("muticities","show")}),listener.on("city","hide",function(){e.hide()}),listener.on("city","hasaoi",function(t,i){e.showAoi(i)})},showCities:function(){var e=this;return e.cities?void e._htmlCities(e.cities):void $.ajax({url:"/waimai?qt=getcitylist&format=1",data:{t:(new Date).getTime()},dataType:"json",beforeSend:function(){e.$el.empty().addClass("loading").show()},success:function(t){if(t.result){var i=t.result;e.cities=i,setTimeout(function(){e._htmlCities(i)},0)}},error:function(){}})},_htmlCities:function(e){var t=this,i=citiesTpl(e);t.$el.removeClass("loading").html(i).show()},_htmlAois:function(e){var t=this,i=aoisTpl(e);t.$el.html(i).removeClass("loading").show(),listener.trigger("mask","show")},hide:function(){var e=this;e.$el.hide().empty()},showAoi:function(e){var t=this;return t.aois[e.code]?void t._htmlAois(t.aois[e.code]):void $.ajax({url:"/waimai?qt=getcitylist",data:{city_id:e.code,t:(new Date).getTime()},dataType:"json",beforeSend:function(){},success:function(i){if(i.result){var a=i.result;t.aois[e.code]=a,setTimeout(function(){t._htmlAois(a)},0)}},error:function(){}})}}),module.exports=new Muti});